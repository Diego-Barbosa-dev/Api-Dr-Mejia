<section class="panel" id="moduleOrdenes" data-section="ordenes" data-roles="admin,assistant,provider">
  <div class="panel-header">
    <h2>Consolidado de Órdenes</h2>
    <button class="btn-outline" id="toggleOrdenFilters" title="Filtros">
      <iconify-icon icon="ph:funnel"></iconify-icon>
    </button>
  </div>

  <div class="tabs">
    <button class="tab active" data-target="#listaOrdenes">Lista</button>
    <button class="tab" data-target="#formOrden">Crear</button>
  </div>

  <!-- Filters Modal -->
  <div id="ordenFilters" class="filters-panel" hidden>
    <div class="field">
      <label>Paciente</label>
      <input id="filtroOrdenPaciente" type="text" placeholder="Buscar por nombre..." />
    </div>
    <div class="field">
      <label>Proveedor</label>
      <select id="filtroOrdenProveedor">
        <option value="">Todos</option>
      </select>
    </div>
    <div class="field">
      <label>Estado</label>
      <select id="filtroOrdenEstado">
        <option value="">Todos</option>
        <option value="CREADA">Creada</option>
        <option value="ENVIADA">Enviada</option>
        <option value="EN_PROGRESO">En progreso</option>
        <option value="EN_RUTA">En ruta</option>
        <option value="RECIBIDA">Recibida</option>
        <option value="COMPLETADA">Completada</option>
        <option value="CANCELADA">Cancelada</option>
      </select>
    </div>
    <div class="field">
      <label>Fecha</label>
      <input id="filtroOrdenFecha" type="date" />
    </div>
    <div style="display:flex;gap:8px;margin-top:12px;">
      <button class="btn-primary" id="btnAplicarFiltrosOrdenes">Aplicar</button>
      <button class="btn-outline" id="limpiarFiltrosOrden">Limpiar</button>
    </div>
  </div>

  <!-- Orders List -->
  <div id="listaOrdenes" class="orders-list-container"></div>

  <!-- New Order Form -->
  <form id="formOrden" style="display:none;">
    <div class="form-section">
      <h3>Información general</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
        <div class="field">
          <label>Consecutivo</label>
          <input id="ordConsecutivo" type="text" placeholder="Auto" />
        </div>
        <div class="field">
          <label>Número orden</label>
          <input id="ordNumero" type="text" />
        </div>
        <div class="field">
          <label>Fecha envío</label>
          <input id="ordFecha" type="date" />
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div class="field">
          <label>Paciente *</label>
          <input id="ordPaciente" type="text" required />
        </div>
        <div class="field">
          <label>CC/Cédula paciente *</label>
          <input id="ordPacienteCC" type="text" required />
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3>Óptica</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div class="field">
          <label>Clase de lentes</label>
          <select id="ordClaseLentes">
            <option value="bifocal">Bifocal</option>
            <option value="progresivo">Progresivo</option>
            <option value="monofocal">Monofocal</option>
          </select>
        </div>
        <div class="field">
          <label>Tipo lentes/filtros (asesor)</label>
          <input id="ordTipoLenteFiltros" type="text" />
        </div>
      </div>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;">
        <div class="field">
          <label>OD</label>
          <input id="ordOD" type="text" />
        </div>
        <div class="field">
          <label>OI</label>
          <input id="ordOI" type="text" />
        </div>
        <div class="field">
          <label>ADD</label>
          <input id="ordADD" type="text" />
        </div>
        <div class="field">
          <label>DP y ALT</label>
          <input id="ordDPALT" type="text" />
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3>Proveedor y sede</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div class="field">
          <label>Proveedor *</label>
          <select id="ordProveedor" required></select>
        </div>
        <div class="field">
          <label>Sede</label>
          <select id="ordHeadquarter"></select>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3>Finanzas</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;" data-roles="admin,assistant">
        <div class="field">
          <label>Factura Dr. Mejía</label>
          <input id="ordFacturaDrMejia" type="text" />
        </div>
        <div class="field">
          <label>Factura laboratorio</label>
          <input id="ordFacturaLab" type="text" />
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div class="field" data-roles="admin,assistant">
          <label>Precio venta</label>
          <input id="ordPrecioVenta" type="text" placeholder="$ 0" />
        </div>
        <div class="field" data-roles="admin">
          <label>Precio costo</label>
          <input id="ordPrecioCosto" type="text" placeholder="$ 0" />
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3>Adicional</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div class="field">
          <label>Tipo montura</label>
          <input id="ordTipoMontura" type="text" />
        </div>
        <div class="field" data-roles="admin">
          <label>Tipo lentes (admon)</label>
          <input id="ordTipoLenteAdmon" type="text" />
        </div>
      </div>
      <div class="field">
        <label>Información adicional</label>
        <textarea id="ordInfoAdicional" rows="2"></textarea>
      </div>
      <div class="field">
        <label>Observaciones</label>
        <textarea id="ordObservaciones" rows="2"></textarea>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn-primary">Guardar orden</button>
      <button type="button" id="cancelOrden" class="btn-outline">Cancelar</button>
    </div>
  </form>
</section>
